<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Modern WebSocket Chat Test</title>
    <style>
      /* Thi·∫øt l·∫≠p l·∫°i ki·ªÉu d√°ng c∆° b·∫£n */
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        padding: 40px;
        background: #e9ecef; /* N·ªÅn x√°m nh·∫°t */
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
      }

      /* Container ch√≠nh cho ·ª©ng d·ª•ng chat */
      .chat-container {
        width: 100%;
        max-width: 500px;
        background: #ffffff; /* N·ªÅn tr·∫Øng */
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        padding: 20px;
      }

      /* Ti√™u ƒë·ªÅ */
      h2 {
        text-align: center;
        color: #343a40;
        margin-bottom: 20px;
        font-weight: 600;
      }

      /* Khu v·ª±c log/hi·ªÉn th·ªã tin nh·∫Øn */
      #log {
        border: 1px solid #dee2e6;
        height: 300px;
        padding: 15px;
        overflow-y: auto;
        background: #f8f9fa; /* N·ªÅn log h∆°i x√°m */
        border-radius: 8px;
        margin-bottom: 15px;
        display: flex;
        flex-direction: column; /* Quan tr·ªçng ƒë·ªÉ c√°c tin nh·∫Øn x·∫øp ch·ªìng l√™n nhau */
      }

      /* ƒê·ªãnh d·∫°ng t·ª´ng tin nh·∫Øn trong log */
      #log > div {
        padding: 5px 10px;
        margin-bottom: 5px;
        border-radius: 5px;
        line-height: 1.4;
        word-wrap: break-word; /* ƒê·∫£m b·∫£o tin nh·∫Øn d√†i kh√¥ng tr√†n ra ngo√†i */
      }

      /* Ki·ªÉu d√°ng cho tin nh·∫Øn tr·∫°ng th√°i */
      #log > div[style*="black"] {
        background-color: #e9ecef;
        color: #495057 !important;
        font-size: 0.9em;
        text-align: center;
      }

      /* Ki·ªÉu d√°ng cho tin nh·∫Øn g·ª≠i ƒëi (Sent) */
      #log > div[style*="green"] {
        background-color: #d4edda;
        color: #155724 !important;
        align-self: flex-end; /* CƒÉn ph·∫£i */
      }

      /* Ki·ªÉu d√°ng cho tin nh·∫Øn nh·∫≠n ƒë∆∞·ª£c (Received) */
      #log > div[style*="blue"] {
        background-color: #cce5ff;
        color: #004085 !important;
        align-self: flex-start; /* CƒÉn tr√°i */
      }

      /* Khu v·ª±c nh·∫≠p v√† g·ª≠i tin nh·∫Øn */
      .input-group {
        display: flex;
        gap: 10px; /* Kho·∫£ng c√°ch gi·ªØa input v√† button */
      }

      /* Thanh nh·∫≠p li·ªáu */
      #msg {
        flex-grow: 1;
        padding: 10px 15px;
        border: 1px solid #ced4da;
        border-radius: 6px;
        font-size: 16px;
      }

      /* N√∫t g·ª≠i */
      #send {
        padding: 10px 20px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: background 0.3s ease;
      }

      #send:hover {
        background: #0056b3;
      }

      #send:active {
        background: #003f7f;
      }
    </style>
  </head>
  <body>
    <div class="chat-container">
      <h2>üí¨ WebSocket Chat Tester</h2>
      <div id="log"></div>
      <div class="input-group">
        <input id="msg" placeholder="Nh·∫≠p tin nh·∫Øn..." autocomplete="off" />
        <button id="send">G·ª≠i</button>
      </div>
    </div>

    <script>
      // *** LOGIC G·ªêC ƒê∆Ø·ª¢C GI·ªÆ NGUY√äN ***

      const ws = new WebSocket("ws://localhost:8080/ws/chat");
      const log = document.getElementById("log");
      const msg = document.getElementById("msg");
      const sendBtn = document.getElementById("send");

      function append(message, type = "info") {
        const div = document.createElement("div");

        // C·∫≠p nh·∫≠t n·ªôi dung hi·ªÉn th·ªã cho d·ªÖ ƒë·ªçc h∆°n
        let displayMessage = message;
        if (type === "sent") {
          displayMessage = "B·∫°n: " + message.replace("üì§ Sent: ", "");
        } else if (type === "recv") {
          displayMessage = "Server: " + message.replace("üì© Received: ", "");
        }

        div.textContent = displayMessage;

        // Logic m√†u s·∫Øc g·ªëc ƒë∆∞·ª£c gi·ªØ nguy√™n ƒë·ªÉ CSS selectors ho·∫°t ƒë·ªông
        div.style.color =
          type === "sent" ? "green" : type === "recv" ? "blue" : "black";

        log.appendChild(div);
        log.scrollTop = log.scrollHeight;
      }

      ws.onopen = () => append("‚úÖ Connected to WebSocket!");
      ws.onclose = () => append("‚ùå Disconnected");
      ws.onerror = (err) => append("‚ö†Ô∏è Error: " + err.message);

      // Th√™m x·ª≠ l√Ω ƒë·ªÉ ch·ªâ hi·ªÉn th·ªã d·ªØ li·ªáu nh·∫≠n ƒë∆∞·ª£c trong e.data
      ws.onmessage = (e) => append(e.data, "recv");

      sendBtn.onclick = () => {
        const text = msg.value.trim();
        if (text) {
          ws.send(text);
          // Ch·ªâ truy·ªÅn text, h√†m append s·∫Ω th√™m "B·∫°n: "
          append(text, "sent");
          msg.value = "";
          msg.focus(); // T·∫≠p trung l·∫°i v√†o √¥ nh·∫≠p li·ªáu
        }
      };

      // Cho ph√©p g·ª≠i tin nh·∫Øn b·∫±ng ph√≠m Enter
      msg.addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
          sendBtn.click();
        }
      });
    </script>
  </body>
</html>
